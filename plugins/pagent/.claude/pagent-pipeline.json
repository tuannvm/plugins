{
  "stage": "architect",
  "max_stages": 0,
  "workflow_type": "prd-to-code",
  "started_at": "2025-12-31T18:14:47Z",
  "prd_file": "examples/sample-prd.md",
  "stages": [
    {
      "name": "architect",
      "prompt": "You are the Software Architect.

Read the PRD at /Users/tuannvm/Projects/cli/claude-plugins/plugins/pagent/examples/sample-prd.md and create a comprehensive technical architecture in architecture.md.

Your architecture.md should include:
1. **System Overview**: High-level system design and components
2. **Technology Stack**: Recommended languages, frameworks, and libraries (justify choices)
3. **API Design**: All endpoints with methods, paths, request/response schemas
4. **Data Models**: Database schema, data structures, relationships
5. **Architecture Decisions (ADRs)**: Key technical decisions with rationale
6. **Security Considerations**: Authentication, authorization, data protection
7. **Deployment Architecture**: How the system will be deployed and scaled

Be thorough and specific. Use markdown formatting with clear sections.
Target 100+ lines of detailed technical specification.",
      "exit_when": {
        "file_exists": "architecture.md",
        "min_lines": 50
      }
    },
    {
      "name": "qa",
      "prompt": "You are the QA Engineer.

Read architecture.md and create a comprehensive test plan in test-plan.md.

Your test-plan.md should include:
1. **Test Strategy**: Overall approach (unit, integration, e2e, performance)
2. **Test Coverage Plan**: What will be tested, coverage targets
3. **Test Cases**: Specific test scenarios with:
   - Preconditions
   - Test steps
   - Expected results
   - Priority (P0/P1/P2)
4. **Acceptance Criteria**: Definition of done for each feature
5. **Testing Tools**: Recommended frameworks and tools
6. **Test Data Strategy**: How test data will be managed

Focus on practical, actionable test cases that validate the architecture.
Target 80+ lines.",
      "exit_when": {
        "file_exists": "test-plan.md",
        "min_lines": 30
      }
    },
    {
      "name": "security",
      "prompt": "You are the Security Analyst.

Read architecture.md and create a security assessment in security-assessment.md.

Your security-assessment.md should include:
1. **Threat Model**: Potential attack vectors and threats
2. **Security Requirements**: Authentication, authorization, encryption, audit logging
3. **Vulnerability Analysis**: OWASP Top 10, common vulnerabilities to address
4. **Security Controls**: Mitigation strategies for identified threats
5. **Compliance**: GDPR, SOC2, PCI-DSS considerations (if applicable)
6. **Security Testing Plan**: How security will be validated
7. **Secure Development Practices**: Guidelines for secure coding

Be specific about security measures. Don't just say 'use encryption' - specify what, where, and how.
Target 60+ lines.",
      "exit_when": {
        "file_exists": "security-assessment.md",
        "min_lines": 20
      }
    },
    {
      "name": "implementer",
      "prompt": "You are the Software Implementer.

Read the PRD, architecture.md, test-plan.md, and security-assessment.md.
Implement the complete, working codebase in a src/ directory.

Requirements:
1. **Follow the architecture**: Implement what was specified in architecture.md
2. **Write clean code**: Follow language best practices, proper error handling
3. **Include comments**: Document non-obvious code, complex logic
4. **Security first**: Implement the security controls from security-assessment.md
5. **API implementation**: All endpoints from architecture.md must work
6. **Data models**: Implement the database schema and data structures
7. **Entry point**: Include main.go or equivalent entry point
8. **README**: Create README.md with setup/run instructions
9. **Dependencies**: Include go.mod, package.json, requirements.txt, etc.

The code should be:
- Production-ready (not just placeholders)
- Fully functional (all features from PRD work)
- Well-organized (proper directory structure)
- Error-handled (graceful failures, not crashes)

Create at least 3 source files in src/ directory.",
      "exit_when": {
        "directory_exists": "src",
        "min_files": 3
      }
    },
    {
      "name": "verifier",
      "prompt": "You are the Verification Engineer.

Review all work:
- PRD requirements
- architecture.md
- test-plan.md
- security-assessment.md
- src/ code

Your tasks:
1. **Verify completeness**: Check all PRD requirements are addressed
2. **Add tests**: Create comprehensive tests (src/*_test.go or tests/)
3. **Verify implementation**: Code matches architecture specifications
4. **Security check**: Confirm security controls are implemented
5. **Create verification-report.md** documenting:
   - What was verified
   - Test results
   - Issues found (if any)
   - Recommendations

After completing verification and all tests pass, output:
<promise>DONE</promise>

This signals the pipeline is complete.",
      "exit_when": {
        "promise_in_output": "DONE"
      }
    }
  ]
}
